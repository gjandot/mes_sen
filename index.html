<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" type="image/png" href="trombico.png">
<meta charset="UTF-8">
<!--IDs
* mode "défi" : tous les sénateurs. Arrêt à la première erreur.
* plusieurs difficultés (nombres de propositions)
* guest stars (anciens sénateurs)
* noms inventés
* prénoms changés
* délai de réponse max
* recherche de combinaisons spéciales (prénoms identiques...) ?
* utilisation des images du trombi ?
-->
<title>Mes-Sen</title>
<style>
#messen { height:420px; width:850px; margin:auto; padding:9px; border-radius:20px; background-color:#C80947; position:relative; }
#loading { font-size:1.2em; color:white; }
#citation a { font-size:1.5em; color:black; border:1px solid white; position:absolute; top:50px; left:300px; font-family: monospace;
		text-decoration:none; margin:20px; background-color:#AAAAAA; padding:9px; }
#progressbar { height:50px; width:40%; margin:auto; }
#progress { width:100%; margin:auto; }
.gamesel { font-size:1.5em; position:relative; height:120px; width:250px; color:white; cursor:pointer; background-color:blue;
			border:3px solid black; margin:10px; border-radius:25px; text-align:center; line-height:120px; }
.gamesel:hover { font-size:2em; border:3px solid yellow; background-color:white; color:blue; }
.tooltip { font-size:1em; color:white; background-color:black; height:45px; width:200px;
			position:absolute; left:300px; padding:9px; text-align:center; vertical-align:middle; }
.tooltip:before { content:""; position:absolute; left:-15px; top:15px; 
			border-top:15px solid transparent; border-right:16px solid black; border-bottom:15px solid transparent;}
#score { border:1px solid white; color:lightblue; background-color:blue; margin:9px; padding:3px; float:right; }
#questprog { border:1px solid white; color:white; background-color:#222266; padding:7px; border-radius:12px; position:relative; }
#questbar { background-color:blue; width:50%; border-radius:9px; padding-top:5px; padding-bottom:5px; }
#questnum { text-align:center; width:100%; position:absolute; top:11px;}

#img0 { height:225px; width:155px; margin:9px; border:1px solid black; border-radius:9px; float:left; }
#noms { float:left; margin-top:25px; }
.nomsen { font-size:1.2em; height:25px; color:white; cursor:pointer; }
.nomsen:hover { font-size:1.4em; color:yellow; }
#nomok { font-size:1.5em; color:#44FF44; }
#nomno { font-size:1.1em; color:#FF8888; }
#imgindic { height:90px; width:62px; border:3px solid red; border-radius:9px; }

#nom0 { font-size:1.4em; color:white; margin-top:25px; padding-bottom:25px; }
.imgsen { height:225px; width:155px; border:1px solid black; border-radius:9px; margin:3px; cursor:pointer; }
.imgsen:hover { transform:scale(1.1); border:3px solid yellow; margin:1px; } 
#imgok { height:247px; width:170px; border:5px solid #44FF44; border-radius:15px; }
#imgno { height:90px; width:62px; border:3px solid red; margin-left:9px; border-radius:9px; }
#nomindic { font-size:1.1em; color:#FF8888; }

#trombi { color:white; }
#tools { position:fixed; top:0; background-color:black; width:100%; padding:20px; }
#listsen { padding-top:45px; }
#nbsen { font-size:1.3em; color:white; border:2px solid white; border-radius:50%; margin-left:50px; padding:5px; background-color:#888888; }
.chactif { color:lightgreen; text-decoration:none; cursor:pointer; border:1px solid lightgreen; }
.chinactif { color:red; text-decoration:line-through; cursor:pointer; } 
.imgtrombi { height:90px; width:62px; border-radius:9px; float:left; }
.infotrombi { float:right; padding-left:5px;}
.senelt { color:white; text-decoration:none; border:1px solid grey; width:22%; padding:3px; margin:9px; box-shadow:3px 3px 5px white; display:inline flex; }
.senelt:hover { background-color:#C80947; }
.senelt a { color:white; text-decoration:none; }
.sennom { font-weight:bold; margin-bottom:20px; }
.sendpt { color:yellow; }

.bouton { font-size:0.8em; background-color:#FFAA44; color:#882222; border-radius:20px; cursor:pointer; display:inline-block; }
.bouton:hover { color:white; }
.quit { position:absolute; bottom:15px; left:15px; }
.reset { float:right; margin-right:99px; background-color:#8888FF; color:yellow; }

#error { font-size:1.1em; color:#C80947; border:1px solid; text-align:center; margin:0 auto; width:33%; background-color:#FFCCCC; }
#version a { font-size:0.8em; color:#777777; position:fixed; bottom:5px; right:9px; text-decoration:none; }
</style>
<noscript>L'application nécessite l'activation de Javascript.</noscript>
</head>
<body onload="start()" style="user-select:none">
<script type="text/javascript">
//
//no framework; it's funnier to reinvent the wheel.
//pas de framework; c'est plus drôle de réinventer la roue.
//
 const APPNAME = "Mes-Sen";
 const VERNUM = "1.018"; //G. JANDOT 17/05/2021
 var trombi_mode = false;

 const MIN_NB_SEN = 200;
 const MAX_NB_SEN = 500;
 const DELAY_SHORT = 900; //ms
 const DELAY_LONG = 4000; //ms (=4s)
 const NB_MAX_PROP = 20;
 const SCORE_1 = 0.75 * NB_MAX_PROP;  //(15/20)
 const SCORE_2 = 0.9 * NB_MAX_PROP;   //(18/20)
 //SCORE_3 = NB_MAX_PROP
 const NO_GROUP = "-Tous les groupes-";
 const NO_COMM = "-Toutes les commissions-";
 const NO_FILTER = "-filtre-"; //lowercase
 const NBSP = "&nbsp;";
 const UTF8_CHECK_MARK = "&#x2705";  // pict. right answer
 const UTF8_CROSS_MARK = "&#x274C";  // pict. wrong answer
 const BASE_SEN_URL = "https://www.senat.fr/";

 var tab_senateurs = []; //objets "senateur"
	// .nom
	// .prenom
	// .id
	// .sexe
	// .groupe
	// .dpt
	// .comm
	// .imgok

 var tab_groupes = [];
 var tab_commissions = [];
 var tab_bonrep = []; //indices:0..4; valeurs : 1..5
 var tab_pastprop = [];

 var bonrep = 0;
 var score = 0;
 var scoremax = 0;
 var async_cpt = 0;
 var nb_imgerr = 0;
 var trombi_h = true;
 var trombi_f = true;
 var current_tip = "";
 var cit_timeout;
 var numcit = -1;
 const CIT_DELAY = 20000; //ms (=30s)
 const CIT_DUR = 15000; //ms (=15s)
 var tab_citations = [
  ["\"Pour l'instant, c'est encore moi qui préside&nbsp;!\" - Christian PONCELET, 29/05/2008", "s20080529002.html#par_268"],
  ["\"Écoutez-moi bien, car cela vaut son pesant de saccharine&nbsp;!\" - Pierre-Yves COLLOMBAT, 24/03/2009", "s20090324020.html#par_2965"],
  ["\"Je crains aussi que l’immobilisme n’avance désormais en Europe et que rien ne puisse l’arrêter.\" - Jean BIZET, 11/04/2019", "s20190411011.html#par_1584"],
  ["\"C’est un peu parallèle, mais ce n’est pas convergent&nbsp;!\" - Bruno SIDO, 17/07/2014", "s20140617020.html#par_2341"],
  ["\"C’est une provocation que je continuerai à défendre – pardon, à dénoncer…\" - Stéphane RAVIER, 09/10/2019", "s20191009006.htmlpar_670"],
  ["\"Personnellement, je n’ai rien contre la chirurgie esthétique, mais pas aux frais du contribuable&nbsp;!\"-  Nathalie GOULET, 04/12/2020", "s20201204005.html#par_725"],
  ["\"Mes chers collègues&nbsp;; je vous rassure, je n’ai déposé aucun amendement visant à introduire la sexualité des bonobos dans la loi&nbsp;!\" - Pierre OUZOULIAS, 02/02/2010", "s20210202006.htmlpar_686"],
  ["\"Je vous remercie de me ramener au calme, monsieur le président.\" - Jean DESESSARD, 18/07/2008", "/s20080718_mono.html#par_699"],
  ["\"J’ai déjà eu l’occasion de le dire dans cet hémicycle, en Auvergne, nous appelons le Téoz le «nbsp;train Oranginanbsp;», en référence au slogannbsp;: «nbsp;Secouez-moi, secouez-moinbsp;!nbsp;».\" - Alan NÉRI, 27/11/2013",
	"s20131127007.html#par_843"]
 ];

 
// refactoring / helpers
 function elt(nom_obj)  { return document.getElementById(nom_obj); }
 function show(nom_obj) { elt(nom_obj).style.display = ""; }
 function hide(nom_obj) { elt(nom_obj).style.display = "none"; }
 function flotte(e)     { hide("citation"); elt(current_tip).style.top = (e.clientY-50) + 'px'; rst_cittime(); }
 function id2img(id)    { return BASE_SEN_URL + "senimg/" + id + ".jpg"; }
 function id2url(id)	{ return BASE_SEN_URL + "senateur/" + id + ".html"; }
 function nomcomplet(i) { return tab_senateurs[i].prenom + " " + tab_senateurs[i].nom; }
 function rnd(n)		{ return Math.floor(n*Math.random()); }
 
//////////////////////////
 
 function start()
 {
	document.body.style.backgroundColor = "black";
	show("loading");
	elt("vernum").innerHTML = VERNUM;
	if (window.location.search.toLowerCase() == "?trombi")
	{
		trombi_mode = true;
	}
	//ajax("https://www.senat.fr/senateurs/sens_alpha.json", parsing);
	hide("loading");
	show("messen");
	new_cit();
	rst_cittime();
	
 }
 
 function sen2id(nom)
 {
	var r = nom.toLowerCase();
	r = r.replace(new RegExp(/ /g),"_");
	r = r.replace(new RegExp(/-/g),"_");
	r = r.replace(new RegExp(/[àáâãäå]/g),"a");
	r = r.replace(new RegExp(/æ/g),"ae");
	r = r.replace(new RegExp(/ç/g),"c");
	r = r.replace(new RegExp(/[èéêë]/g),"e");
	r = r.replace(new RegExp(/[ìíîï]/g),"i");
	r = r.replace(new RegExp(/ñ/g),"n");                
	r = r.replace(new RegExp(/[òóôõö]/g),"o");
	r = r.replace(new RegExp(/œ/g),"oe");
	r = r.replace(new RegExp(/[ùúûü]/g),"u");
	r = r.replace(new RegExp(/[ýÿ]/g),"y");
	return r;
 }
 
 function fullurl(sdate)
 //transforme sAAAAMMJJPPP.html#par_999 en
 //		https://www.senat.fr/seances/sAAAAMM/sAAAAMMJJ/sAAAAMMJJPPP.html#par999
 {
	var res = BASE_SEN_URL + "seances";
	res = res + "/" + sdate.substring(0,7);
	res = res + "/" + sdate.substring(0,9);
	res = res + "/" + sdate;
	return res;
 }
 
 
 function rst_cittime()
 {
	clearTimeout(cit_timeout);
	cit_timeout = setTimeout(deb_cit, CIT_DELAY);
 }
 
 function deb_cit()
 {
	show("citation");
	cit_timeout = setTimeout(fin_cit, CIT_DUR);
 }
 
 function fin_cit()
 {
	hide("citation");
	new_cit();
	cit_timeout = setTimeout(deb_cit, CIT_DELAY);
 }
 
 function new_cit()
 {
	var newcit = rnd(tab_citations.length);
	while (newcit==numcit) //on veut éviter deux fois successivement la même citation
	{
		newcit = rnd(tab_citations.length);
	}
	numcit = newcit;
 	var citation = tab_citations[numcit];
 	elt("citation").innerHTML = "<A TARGET=\"_blank\" HREF=\"" + fullurl(citation[1]) + "\">" +
				citation[0] + "</A>";
 }
 
 function parsing(texte)
 {
	var jsonobj = JSON.parse(texte);
	var jsen = jsonobj['senateurs'];
	
	if ((jsen.length < MIN_NB_SEN) || (jsen.length > MAX_NB_SEN))
	{
		hide("loading");
		elt("error").innerHTML = "Nombre de sénateurs téléchargés (" + jsen.length + ") ";
		if (jsen.length < MIN_NB_SEN)
		{
			elt("error").innerHTML = elt("error").innerHTML + "insuffisant.";
		}
		else
		{
			elt("error").innerHTML = elt("error").innerHTML + "anormalement élevé.";
		}
		show("error");
	}
	else
	{
		for (i=0; i<jsen.length; i++)
		{
			var senateur = new Object();
			senateur.nom = jsen[i]['etat_civil']['nomusecap'];
			senateur.prenom = jsen[i]['etat_civil']['prenomuse']
			senateur.sexe = jsen[i]['etat_civil']['qualite'];
			if (senateur.sexe == "M.")
			{
				senateur.sexe = "H";
			}
			else
			{
				senateur.sexe = "F";
			}
			//le "nom_technique" est malheureusement inexploitable en raison d'un grand nombre d'anomalies
			// (espaces et accents restants, matricule parfois présent et autres curiosités)
			//=>il faut le recalculer
			senateur.id = senateur.nom + "_" + senateur.prenom + jsen[i]['matricule'];
			senateur.id = sen2id(senateur.id);
			try 
			{
				senateur.groupe = jsen[i]['groupe_politique']['nom_court'];
			}
			catch
			//en début de mandat, le groupe n'est pas précisé immédiatement
			{
				senateur.groupe = "";
			}
			senateur.dpt = jsen[i]['circonscription']['nom'];
			try
			{
				senateur.comm = jsen[i]['commission_permanente']['nom_court'];
			}
			catch
			//le/la président.e du Sénat n'appartient à aucune commission permanente
			{
				senateur.comm = "";
			}
			senateur.imgok = true;
			tab_senateurs.push(senateur);
			//LISTE DES GROUPES - groups list
			if (tab_groupes.indexOf(senateur.groupe)==-1)
			{
				tab_groupes.push(senateur.groupe);
			}
			//LISTE DES COMMISSIONS - committees list
			if (senateur.comm!="") //président(e) du Sénat sans commission - no committee for the president
			{
				if (tab_commissions.indexOf(senateur.comm)==-1)
				{
					tab_commissions.push(senateur.comm);
				}
			}
		}
		
		async_cpt = 0;
		elt("loadinfo").innerHTML = "Préparation des données...";
		elt("progress").max = tab_senateurs.length;
		show("progressbar");
		setTimeout(fill_trombi, 0);
	 }
 }
 
 function imgerr(numsen)
 {
	nb_imgerr++;
	tab_senateurs[numsen].imgok = false;
 }
 
 function fill_trombi()
 {
	var i = async_cpt;
	elt("listsen").innerHTML += "<A HREF=\"" + id2url(tab_senateurs[i].id) + "\" TARGET=\"_blank\"><div class=\"senelt\" id=\"" + tab_senateurs[i].id + "\">"
			+ "<img class=\"imgtrombi\" src=\"" + id2img(tab_senateurs[i].id) + "\" onerror=\"imgerr(" + i +" )\">"
			+ "<div class=\"infotrombi\"><div class=\"sennom\">" + nomcomplet(i) + "</div>"
			+ "<div class=\"sengrp\">" + tab_senateurs[i].groupe + "</div>"
			+ "<div class=\"sencom\">" + tab_senateurs[i].comm + "</div>"
			+ "<div class=\"sendpt\">" + tab_senateurs[i].dpt + "</div></div></div></A>";

	
	async_cpt++;
	elt("progress").value = async_cpt;
	if (async_cpt<tab_senateurs.length)
	{
		setTimeout(fill_trombi, 0);
	}
	else
	{
		hide("loading");
		tab_groupes.sort();
		var grp = elt("selgrp");
		grp.innerHTML = "<option value=\"\">" + NO_GROUP + "</option>";
		for (i=0; i< tab_groupes.length; i++)
		{
			grp.innerHTML += "<option value=\"" + tab_groupes[i] + "\">" + tab_groupes[i] + "</option>"
		}
		var com = elt("selcom");
		com.innerHTML = "<option value=\"\">" + NO_COMM + "</option>";
		for (i=0; i< tab_commissions.length; i++)
		{
			com.innerHTML += "<option value=\"" + tab_commissions[i] + "\">" + tab_commissions[i] + "</option>"
		}
		reset(); //init trombi
		if (trombi_mode)
		{
			hide("return");
			launch(3);
		}
		else
		{
			show("messen");
			if (nb_imgerr > (tab_senateurs.length/10))
			{
				elt("error").innerHTML = "Trop de photographies (" + nb_imgerr + ") sont manquantes.";
				show("error");
				hide("c1");
				hide("c2");
			}
		}
	}
 }

 function ajax(url,callback)
 {
	var httpRequest = new XMLHttpRequest();
	if (!httpRequest){ return false; }
	httpRequest.onreadystatechange=function()
	{
		try {
			if (httpRequest.readyState===XMLHttpRequest.DONE && httpRequest.status===200)
			{
				callback(httpRequest.responseText);
			}
		} catch(e){ return false; }
	}
	httpRequest.open('GET',url);
	httpRequest.send();
	return true;
 }
 
 function launch(numjeu)
 {
	clearTimeout(cit_timeout);
	hide("menu");
	show("quit");
	show("questprog");
	show("score");
	switch (numjeu) {
		case 1:
			show("game1");
			game1(-1);
			break
		case 2:
			show("game2");
			game2(-1);
			break;
		case 3:
			hide("messen");
			show("trombi");
			document.title = APPNAME + "- Trombi";
			break;
	}
 }
 
 function quit() //exit trombi
 {
	document.title = APPNAME;
	hide("game1");
	hide("game2");
	hide("trombi");
	hide("questprog");
	hide("score");
	hide("quit");
	show("messen");
	show("menu");
	rst_cittime();
 }
 
 function reset() // reset trombi
 {
	hide("reset");
	trombi_h = true;
	trombi_f = true;
	elt("selgrp").selectedIndex = 0;
	elt("selcom").selectedIndex = 0;
	elt("filtre").value = NO_FILTER;
	elt("filtre").style.color = "#BBBBBB";
	majtrombi(0);
 }
 
 function starscore(score)
 {
	var res = "";
	var stars = 0;
	const UTF8_STAR = "&#x2B50;";
	const UTF8_EMPTY_STAR = "&#x2606;";
	if (score>=SCORE_1) 	{ stars++; }
	if (score>=SCORE_2) 	{ stars++; }
	if (score>=NB_MAX_PROP) { stars++; }
	for (i=0; i<stars; i++)   { res += NBSP + UTF8_STAR; }
	for (i=0; i<3-stars; i++) {	res += NBSP + UTF8_EMPTY_STAR; }
	return res;
 }
 
 function game1(val)
 {
	hide("nomok");
	hide("imgindic");
	hide("nomno");
 
	//val : -1 pour initialisation
	if (val>-1)
	{
		scoremax = scoremax + 1;
		if (val==bonrep)
		{
			score = score + 1;
		}
	}
	else
	{
		score = 0;
		scoremax = 0;
		tab_pastprop.length = 0;
	}
	document.title = APPNAME + "- PHOTO " + (scoremax+1) + "/" + NB_MAX_PROP;
	elt("questnum").innerHTML = "PHOTO " + (scoremax+1) + "/" + NB_MAX_PROP;
	elt("questbar").style.width = (100*scoremax/NB_MAX_PROP) + "%";
	elt("score").innerHTML = "SCORE = " + score + "/" + scoremax + " - " + starscore(score);
	
	if (scoremax>=NB_MAX_PROP)
	{		
		hide("game1");
		show("menu");
		rst_cittime();
		hide("quit");
		document.title = "SCORE FINAL = " + score + "/" + scoremax; 
		hide("questprog");
	    elt("score").innerHTML = "SCORE FINAL = " + score + "/" + scoremax + " - " + starscore(score);
		return;
	}
		
	var n = tab_senateurs.length;
	var num1 = rnd(n);
	while (!tab_senateurs[num1].imgok)
	{
		num1 = rnd(n);
	}
	var sexeref = tab_senateurs[num1].sexe;
	var num2 = rnd(n);
	var sexe = tab_senateurs[num2].sexe;
	while ((num2==num1) || (sexe!=sexeref) || (!tab_senateurs[num2].imgok))
	{
		num2 = rnd(n);
		sexe = tab_senateurs[num2].sexe;
	}
	var num3 = rnd(n);
	sexe = tab_senateurs[num3].sexe;
	while ((num3==num2) || (num3==num1) || (sexe!=sexeref) || (!tab_senateurs[num3].imgok))
	{
		num3 = rnd(n);
		sexe = tab_senateurs[num3].sexe;
	}
	var num4 = rnd(n);
	sexe = tab_senateurs[num4].sexe;
	while ((num4==num3) || (num4==num2)|| (num4==num1) || (sexe!=sexeref) || (!tab_senateurs[num4].imgok))
	{
		num4 = rnd(n);
		sexe = tab_senateurs[num4].sexe;
	}
	var num5 = rnd(n);
	sexe = tab_senateurs[num5].sexe;
	while ((num5==num4) || (num5==num3) || (num5==num2) || (num5==num1) || (sexe!=sexeref) || (!tab_senateurs[num5].imgok))
	{
		num5 = rnd(n);
		sexe = tab_senateurs[num5].sexe;
	}
	//5 fausses réponses **différentes**
	elt("nom1").innerHTML = nomcomplet(num1);
	elt("nom2").innerHTML = nomcomplet(num2);
	elt("nom3").innerHTML = nomcomplet(num3);
	elt("nom4").innerHTML = nomcomplet(num4);
	elt("nom5").innerHTML = nomcomplet(num5);
	tab_bonrep[0] = num1;
	tab_bonrep[1] = num2;
	tab_bonrep[2] = num3;
	tab_bonrep[3] = num4;
	tab_bonrep[4] = num5;
	
	//écrasement avec la bonne réponse à un endroit (bonrep [1..5])) au hasard
	var vnum = 0;
	var prop_ok = true;
	do
	{
		vnum = rnd(n);
		sexe = tab_senateurs[vnum].sexe;
		while ((vnum==num5) || (vnum==num4) || (vnum==num3) || (vnum==num2) || (vnum==num1) || (sexe!=sexeref) || (!tab_senateurs[vnum].imgok) )
		{
			vnum = rnd(n);
			sexe = tab_senateurs[vnum].sexe;
		}
		prop_ok = true;
		for (i=0; i<tab_pastprop.length; i++)
		{
			if (vnum==tab_pastprop[i])
			{
				prop_ok = false;
			}
		}
	} while (!prop_ok);
	tab_pastprop.push(vnum);

	bonrep = rnd(5)+1;
	elt("img0").src = id2img(tab_senateurs[vnum].id);
	var varnom = "nom" + bonrep;
	elt(varnom).innerHTML = nomcomplet(vnum);
	elt("nomok").innerHTML = elt(varnom).innerHTML;	
	show("nom1");
	show("nom2");
	show("nom3");
	show("nom4");
	show("nom5");
 }
 
 function verif1(rep)
 {
	hide("nom1");
	hide("nom2");
	hide("nom3");
	hide("nom4");
	hide("nom5");
	show("nomok");
	var delay = DELAY_SHORT;
	if (rep!==bonrep) {
		delay = DELAY_LONG;
		elt("nomno").innerHTML = UTF8_CROSS_MARK + NBSP + elt("nom"+rep).innerHTML;
		show("nomno");
		elt("imgindic").src = id2img(tab_senateurs[tab_bonrep[rep-1]].id);
		show("imgindic");
	}
	else
	{
		elt("nomok").innerHTML = UTF8_CHECK_MARK + NBSP + elt("nomok").innerHTML;
	}
	setTimeout(function(){ game1(rep); }, delay);
 }

 function game2(val)
 {
 	hide("imgok");
	hide("nomindic");
	hide("imgno");
 
	//val : -1 pour initialisation
	if (val>-1)
	{
		scoremax = scoremax + 1;
		if (val==bonrep)
		{
			score = score + 1;
		}
	}
	else
	{
		score = 0;
		scoremax = 0;
		tab_pastprop.length = 0;
	}
	document.title = APPNAME + "- NOM " + (scoremax+1) + "/" + NB_MAX_PROP;
	elt("questnum").innerHTML = "NOM " + (scoremax+1) + "/" + NB_MAX_PROP;
	elt("questbar").style.width = (100*scoremax/NB_MAX_PROP) + "%";
	elt("score").innerHTML = "SCORE = " + score + "/" + scoremax + " - " + starscore(score);
	
	if (scoremax>=20)
	{		
		hide("game2");
		show("menu");
		rst_cittime();
		hide("quit");
		document.title = "SCORE FINAL = " + score + "/" + scoremax;
		hide("questprog");
		elt("score").innerHTML = "SCORE FINAL = " + score + "/" + scoremax + " - " + starscore(score);
		return;
	}
	
	var n = tab_senateurs.length;
	var num1 = rnd(n);
	while (!tab_senateurs[num1].imgok)
	{
		num1 = rnd(n);
	}
	var sexeref = tab_senateurs[num1].sexe;

	var num2 = rnd(n);
	var sexe = tab_senateurs[num2].sexe;
	while ((num2==num1) || (sexe!=sexeref) || (!tab_senateurs[num2].imgok))
	{
		num2 = rnd(n);
		sexe = tab_senateurs[num2].sexe;
	}
	var num3 = rnd(n);
	sexe = tab_senateurs[num3].sexe;
	while ((num3==num2) || (num3==num1) || (sexe!=sexeref) || (!tab_senateurs[num3].imgok))
	{
		num3 = rnd(n);
		sexe = tab_senateurs[num3].sexe;
	}
	var num4 = rnd(n);
	sexe = tab_senateurs[num4].sexe;
	while ((num4==num3) || (num4==num2)|| (num4==num1) || (sexe!=sexeref) || (!tab_senateurs[num4].imgok))
	{
		num4 = rnd(n);
		sexe = tab_senateurs[num4].sexe;
	}
	var num5 = rnd(n);
	sexe = tab_senateurs[num5].sexe;
	while ((num5==num4) || (num5==num3) || (num5==num2) || (num5==num1) || (sexe!=sexeref) || (!tab_senateurs[num5].imgok))
	{
		num5 = rnd(n);
		sexe = tab_senateurs[num5].sexe;
	}
	//5 fausses réponses **différentes**
	elt("img1").src = id2img(tab_senateurs[num1].id);
	elt("img2").src = id2img(tab_senateurs[num2].id);
	elt("img3").src = id2img(tab_senateurs[num3].id);
	elt("img4").src = id2img(tab_senateurs[num4].id);
	elt("img5").src = id2img(tab_senateurs[num5].id);
	tab_bonrep[0] = num1;
	tab_bonrep[1] = num2;
	tab_bonrep[2] = num3;
	tab_bonrep[3] = num4;
	tab_bonrep[4] = num5;
	
	//écrasement avec la bonne réponse à un endroit ("bonrep" [1..5]) au hasard
	var vnum = 0;
	var prop_ok = true;
	do
	{
		vnum = rnd(n);
		sexe = tab_senateurs[vnum].sexe;
		while ((vnum==num5) || (vnum==num4) || (vnum==num3) || (vnum==num2) || (vnum==num1) || (sexe!=sexeref) || (!tab_senateurs[vnum].imgok))
		{
			vnum = rnd(n);
			sexe = tab_senateurs[vnum].sexe;
		}
		prop_ok = true;
		for (i=0; i<tab_pastprop.length; i++)
		{
			if (vnum==tab_pastprop[i])
			{
				prop_ok = false;
			}
		}
	} while (!prop_ok);
	tab_pastprop.push(vnum);
	
	bonrep = rnd(5)+1;
	elt("nom0").innerHTML= nomcomplet(vnum);
	var varimg = "img" + bonrep;
	elt(varimg).src = id2img(tab_senateurs[vnum].id);
	elt("imgok").src = elt(varimg).src;
	show("img1");
	show("img2");
	show("img3");
	show("img4");
	show("img5");
 }
 
 function verif2(rep)
 {
 	hide("img1");
	hide("img2");
	hide("img3");
	hide("img4");
	hide("img5");
	show("imgok");
	var delay = DELAY_SHORT;
	if (rep!==bonrep) {
		delay = DELAY_LONG;
		elt("imgno").src = elt("img"+rep).src;
		show("imgno");
		elt("nomindic").innerHTML = nomcomplet(tab_bonrep[rep-1]);
		show("nomindic");
	}
	setTimeout(function(){ game2(rep); }, delay);
 }

 function initfilter()
 {
	if (elt("filtre").value == NO_FILTER)
	{
		elt("filtre").value = "";
		elt("filtre").style.color = "black";
	}
 }

 function majtrombi(action)
 {
	var filtre = elt("filtre").value.toLowerCase().trim();
	var filgrp = elt("selgrp").options[elt("selgrp").selectedIndex].text;
	var filcom = elt("selcom").options[elt("selcom").selectedIndex].text;
	if (action==1)//hommes
	{
		trombi_h = !trombi_h;
		if (!trombi_f && !trombi_h)
		{
			trombi_f = true;
		}
	}
	if (action==2)//femmes
	{
		trombi_f = !trombi_f;
		if (!trombi_f && !trombi_h)
		{
			trombi_h = true;
		}
	}
	if (trombi_h && trombi_f)
	{
		hide("reset");
	}
	else
	{
		show("reset");
	}
	
	
	if (trombi_h)
	{
		elt("hommes").className = "chactif";
	}
	else
	{
		elt("hommes").className = "chinactif";
	}
	if (trombi_f)
	{
		elt("femmes").className = "chactif";
	}
	else
	{
		elt("femmes").className = "chinactif";
	}
	if ( (filtre!= NO_FILTER && filtre!="")
			|| (filgrp != NO_GROUP)
			|| (filcom != NO_COMM)
		)
	{
		show("reset");
	}

	for (i=0; i<tab_senateurs.length; i++)
	{
		if (tab_senateurs[i].sexe == "H")
		{
			if (trombi_h)
			{
				show(tab_senateurs[i].id);
			}
			else
			{
				hide(tab_senateurs[i].id);
			}				
		}
		else //F
		{
			if (trombi_f)
			{
				show(tab_senateurs[i].id);
			}
			else
			{
				hide(tab_senateurs[i].id);
			}
		}
		
		if (filtre!= NO_FILTER && filtre!="")
		{
			if ((!(nomcomplet(i).toLowerCase()).includes(filtre)))
			{
				hide(tab_senateurs[i].id);
			}
		}
		if (filgrp != NO_GROUP)
		{
			if (tab_senateurs[i].groupe != filgrp)
			{
				hide(tab_senateurs[i].id);
			}
		}
		if (filcom != NO_COMM)
		{
			if (tab_senateurs[i].comm != filcom)
			{
				hide(tab_senateurs[i].id);
			}
		}
	}

	var cptsen = 0;
	for (i=0; i<tab_senateurs.length; i++)
	{
		if (elt(tab_senateurs[i].id).style.display == "")
		{
			cptsen++;
		}
	}
	elt("nbsen").innerHTML = cptsen;
	if (cptsen==0)
	{
		show("vide");
	}
	else
	{
		hide("vide");
	}
 }
</script>
<BR>
<div id="loading" style="display:none">
<p align="center"><img src="senanim.gif" style="vertical-align:middle" width="50" height="52" ALT="Logo">
<span id="loadinfo">Téléchargement des données...</span>
<div id="progressbar" style="display:none"><progress id="progress" value="0" max="100"></progress></div>
</div> <!--/loading-->

<div id="error" style="display:none"></div>

<div id="messen" style="display:none">

<div id="questprog" style="display:none"><div id="questbar">&nbsp;</div><span id="questnum"></span></div>
<div id="score" style="display:none"></div>

<div id="menu">
<div id="c1" onclick="launch(1)" class="gamesel"
		onmouseenter="current_tip='tip1'; show('tip1')" onmouseleave="hide('tip1')" onmousemove="flotte(event)"
		>"Quel nom&nbsp;?"</div>
<div id="tip1" style="display:none" class="tooltip">Pour 1 photo, 5 noms.<BR>Il faut trouver le bon.</div>
<div id="c2" onclick="launch(2)" class="gamesel"
		onmouseenter="current_tip='tip2'; show('tip2')" onmouseleave="hide('tip2')" onmousemove="flotte(event)"
		>"Quelle photo&nbsp;?"</div>
<div id="tip2" style="display:none" class="tooltip">Pour 1 nom, 5 photos.<BR>Il faut trouver la bonne.</div>
<div id="c3" onclick="launch(3)" class="gamesel"
			onmouseenter="current_tip='tip3'; show('tip3')" onmouseleave="hide('tip3')" onmousemove="flotte(event)"
		>Trombi</div>
<div id="tip3" style="display:none" class="tooltip">Trombinoscope<BR>interactif</div>
</div> <!--/menu-->

<div id="citation" style="display:none"></div>

<div id="game1" style="display:none">
<img id="img0" title="Il faut cliquer sur le nom qui correspond à cette photo.">
<div id="noms">
<div id="nom1" class="nomsen" onclick="verif1(1)"></div>
<div id="nom2" class="nomsen" onclick="verif1(2)"></div>
<div id="nom3" class="nomsen" onclick="verif1(3)"></div>
<div id="nom4" class="nomsen" onclick="verif1(4)"></div>
<div id="nom5" class="nomsen" onclick="verif1(5)"></div>
<div id="nomok"></div>
<div id="nomno"></div><img id="imgindic">
</div> <!--/noms-->
</div> <!--/game1-->

<div id="game2" style="display:none">
<div id="nom0" title="Il faut cliquer sur la photo qui correspond à ce nom."></div>
<img id="img1" class="imgsen" onclick="verif2(1)">
<img id="img2" class="imgsen" onclick="verif2(2)">
<img id="img3" class="imgsen" onclick="verif2(3)">
<img id="img4" class="imgsen" onclick="verif2(4)">
<img id="img5" class="imgsen" onclick="verif2(5)">
<img id="imgok">
<img id="imgno">&nbsp;<span id="nomindic"></span>
</div> <!--/game2-->

<button id="quit" style="display:none" onclick="quit()" class="bouton quit">Abandonner</button>
</div> <!--/messen-->

<div id="trombi" style="display:none">
<div id="tools">
<span id="hommes" onclick="majtrombi(1)" class="chactif">Hommes</span>&nbsp;
<span id="femmes" onclick="majtrombi(2)" class="chactif">Femmes</span>&nbsp;
<select id="selgrp" onchange="majtrombi(0)" title="Sélection d'un groupe politique"></select>
<select id="selcom" onchange="majtrombi(0)" Title="Sélection d'une commission permanente"></select>
<input id="filtre" type="text" oninput="majtrombi(0)" onfocus="initfilter()" title="Filtre sur les noms et prénoms">
<button id="return" onclick="quit()" class="bouton" title="Revenir au menu">Retour</button>
<span id="nbsen" title="Compteur de résultats"></span>
<button id="reset" onclick="reset()" style="display:none" class="bouton reset" title="Effacer les filtres de recherche">Réinitialiser</button>
</div> <!--tools-->
<div id="listsen"></div>
<div id="vide" class="senelt" style="display:none">Aucun résultat.</div>
</div> <!--/trombi-->

<div id="version" title="testée sous Windows 10 avec Firefox 78.9.0esr"><A HREF="https://github.com/gjandot/mes_sen/">Version <span id="vernum">0.000</span></A></div>

</body>
</html>
